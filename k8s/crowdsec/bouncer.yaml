apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: main-crowdsec-bouncer
  namespace: crowdsec
spec:
  plugin:
    crowdsec-bouncer:
      # needs to be fresh generated with cscli bouncer add <name>
      # needs to be substituted using `envsubst`, outputting to new file
      crowdsecLapiKey: "$CROWDSEC_BOUNCER_KEY"  
      enabled: true
      logLevel: DEBUG
      crowdsecMode: none
      crowdsecLapiScheme: http
      # adding the namespace (the .crowdsec) was the missing piece!
      crowdsecLapiHost: crowdsec-service.crowdsec:8080
      httpTimeoutSeconds: 60
      forwardedHeadersTrustedIPs:
        - 10.0.0.0/8
        - 192.168.0.0/16
        - 134.209.137.94
        - 2a03:b0c0:2:f0::f557:a001
      crowdsecAppsecEnabled: true
      crowdsecAppsecHost: crowdsec-appsec-service.crowdsec:7422
      crowdsecAppsecFailureBlock: true
      crowdsecAppsecUnreachableBlock: true
